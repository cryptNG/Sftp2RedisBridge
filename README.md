# File2EventBridge
## building bridges for the dev world

*File2EventBridge* and by extension the project **Sftp2RedisBridge** are a system that provides a simple, predefined and easily configurable/adjustable way to grab files (currently from an _ftp/sftp server in Sftp2RedisBridge_) and ingest found content into different consuming systems

## The process

Sftp2RedisBridge grabs Sftp Files from a remote server when they show up (polling, configurable interval) and creates events in Redis streams while also adding necessary information into a redis KVDB.
Every file found will be automatically assigned a transport UID from the Sftp2RedisBridge, this will be used to identify a file later in the process.
To be able to correlate server files to a UID, the tool creates a local cache in the Redis KVDB called "RemoteFiles", this way even if the tool stops or is killed by an error, it can resume work at any state.

In this example, if files are detected, Sftp2RedisBridge creates following information in Redis:
>KVDB: Process:{autoGeneratedTransportUID}:Filename - Name of the file including extension.
>
>KVDB; Process:{autoGeneratedTransportUID}:File - File data as base64 encrypted binary array

Any process along the redis pipeline may pick these values up and work with them.
When a process encounters an error, Sftp2RedisBridge expects a transportUID entry in a stream (here specified as errorStream, customizable).
Sftp2RedisBridge will constantly scan for new entries in this stream, if it detects a Redis Message, it will parse the transportUID and find the corresponding file on the Sftp Server.
As this is an error case, the file on the server will be moved to an "error" folder (customizable), at the same time, the sender of the error message may specify an error file in the Redis KVDB like so:

>KVDB: Error:{transportUID}:Filename - Name of the error file to generate

>KVDB: Error:{transportUID}:File - B64 encoded binary of the error file

if found, the Sftp2RedisBridge will retrieve these keys and create the defined file in the Server ERROR directory defined in the config.
The errorStream message will then be acknowledged.

In case of a success, the consumer along the redis pipeline has to send a message containing the transportUID as Key to a success Stream (doneStream in this case, customizable).
If Sftp2RedisBridge notices a transportUID in the doneStream, it will delete the corresponding file on the server and acknowledge the message.

## The acceptance tests
To run the acceptance tests, please ensure that both, the Sftp2RedisBridge and the Redis Database are available (ideally running in docker).
Worst case, you will need to have 2 instances of visual Studio running, one for the Sftp2RedisBridge and one for the acceptance tests, while still running REDIS seperately.

## Configuration priorities
Sftp2RedisBridge looks for following configuration files in this order:
{ENVIRONMENT VAR CONFIG_FILE}
appsettings.docker.json
appsettings.{HOSTNAME}.json
appsettings.json

## Intercompatibility
Sftp2RedisBridge is written in .Net 5 and can be run in linux and windows docker containers or machines featuring the .Net 5 Framework.

## Contribution
please feel free to contribute to the project
